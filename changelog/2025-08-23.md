

# 2025-08-23 系統更新日誌

## 主要修復項目

### 群組聊天「不回應」機制修復

**問題描述**：
AI 在群組對話中判斷「不回應」時，前端仍然顯示「正在輸入（三個點動畫）」不會停止，造成使用者誤解。

* 前端持續等待訊息結束標記
* 未收到有效訊號時導致動畫卡住
* 使用者體驗不佳

**解決方案**：

1. **後端新增「no\_response」訊號**

   * 在 `handle_group_chat()` 中判斷 `should_respond == False` 時，傳送 `{"type": "no_response"}` 給前端
   * 避免傳送空訊息或缺少結束標記

2. **前端接收「no\_response」訊號**

   * 在 `handleWebSocketMessage()` 新增判斷
   * 收到後立即停止動畫，重置狀態

---

## 修改的文件

### 後端文件

1. **Service/llm.py**

   * `handle_group_chat()`：新增 `no_response` 訊號傳送邏輯

### 前端文件

1. **src/components/chatWindow/chatWindow\.vue**

   * `handleWebSocketMessage()`：新增 `no_response` 訊號判斷
   * 停止「三個點」動畫並重置 `responsing` 與 `receive_state`



---

### 後端修復程式碼片段

```python
if not should_respond:
    await chat_manager.broadcast(
        f"group_{group_id}",
        json.dumps({
            "type": "no_response",
            "sender_role": "bot",
            "message": "",
            "chat_room_id": group_id,
        })
    )
    return
```

### 前端修復程式碼片段

```javascript
if (messageData.type === 'no_response') {
    responsing.value = false;
    receive_state.value = 0;
    console.log('AI選擇不回應，停止打字動畫');
    return;
}
```

---

要不要我幫你把這份日誌加上 **「未來優化方向」**（例如：支援多種「狀態型訊號」像是 typing、thinking、no\_response），讓後續擴充更乾淨？
